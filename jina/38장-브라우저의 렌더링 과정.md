# 38장-브라우저의 렌더링 과정
자바스크립트 실행 환경: 브라우저에서 HTML, CSS와 함께 실행

* 파싱: 토큰에 문법적 의미와 구조를 반영해 파스 트리를 생성하는 일련의 과정
* 렌더링: HTML, CSS, 자바스크립트로 작성된 문서를 파싱해 브라우저에 시각적으로 출력

브라의저의 렌더링 과정
1. HTML,CSS, 자바스크립 등 렌더링에 필요한 리소르를 서버에 요청하고 응답을 받음
2. 응답된 HTML과 CSS를 파싱해 DOM, CSSOM을 생성하고 이를 결합해 렌더 트리 생성
3. 브라우저의 자바스크립트는 AST를 생성하고 바이트코드로 변환해 실행. 이때 자바스크립트에 의해 변경된 DOM과 CSSOM은 다시 렌더 트리로 결합
4. 렌더 트리를 기반으로 HTML 요소의 레이아웃을 계산하고 화면에 페인팅

## 1. 요청과 응답
* 요청: 주소창의 주소를 통해 요청. 또는 자바스크립트를 통해 동적으로 요창

## 2. HTTP 1.1과 HTTP 2.0
HTTP
* 웹에서 브러우저와 서버가 통신하기 위한 프로토콜.
* 팀 버너스리가 고안

HTTP/1.1
* 한개의 요청만 전송

HTTP/2.0
* 다중요청/응답 
* 페이지 로드 속도가 빠름 

## 3. HTML 파싱과 DOM 생성
DOM
* 브라우저가 이해할 수 있는 자료구조 

브라우저의 렌더링 엔진 파싱 과정
* 바이트 -> 문자 -> 토큰 -> 노드 -> DOM
1. (바이트) 서버는 HTML파일을 2진수로 응답
2. (문자) 브라우저는 응답받은 2진수 데이터를 응답 헤더의 content-type(meta 태그의 charset 어트리뷰트)에의해 인코딩함 
3. (토큰) 문서를 최소 단위인 토큰으로 분해
4. (노드) 각 토큰을 객체로 반환
5. (DOM) 트리 자료구조

## 4. CSS 파싱과 CSSOM 생성
* 렌더링 엔진은 HTML을 처음부터 한 줄씩 파싱해 DOM 생성
* <link/> <style/> 태그를 만나면 DOM 생성을 일시 중단
* HTML와 같은 파싱 과정을 통해 CSSOM 생성함
* Css 상속 관계가 반영됨

## 5. 렌더 트리 생성
렌더 트리
* 렌더링을 위한 트리 구조
* 브라우저 화면에 렌더링되지 않는 노드와 CSS에 비표시되는 노드는 포함X

리렌더링
* 자바스크립트에 의한 노드 변경
* 브라우저창의 리사이징에 의한 뷰포트 크기 변경
* 레이아웃 변경을 발생시키는 스타일 변경
-> 리렌더링은 성능에 악영향을 줌

## 6. 자바스크립트 파싱과 실행
자바스크립트 파싱은 자바스크립트 엔진에게 제어권이 넘어감

자바스크립트 엔진의 자바스크립트 파싱
* AST 생성 -> 바이트코드 생성 -> 바이트 코드 실행
* 토크나이징 -> 파싱 -> 바이트코드 생성 -> 실행

AST은 토큰에 문법적 의밍와 구조를 반영한 트리구조
AST를 사용해 트랜스파일러(Typescript, Bable, Prettier)를 구현가능

## 7. 리플로우와 리페인트
리플로우
* 레이아웃 계산을 다시 하는 것
* 노드 추가/삭제, 요소의 크기/위치 변경, 윈도우 리사이징

리페인트
* 재결합된 렌더 트리를 기반으로 다시 페인트 

-> 레이아웃에 영향이 없는 변경은 리페인트만 실행됨

## 8. 자바스크립트 파싱에 의한 HTML파싱 중단
* 브라우전은 동기전으로, 순차적으로 파싱과 실행을 함
* <script/>는 위치에 따라 HTML 파싱이 블로킹되어 DOM생성이 지연될 수 있음
* <script/>는 최하단에 위치 권고 
	* DOM 조작시 에러 방지
	* 페이지 로딩 시간이 단축

